<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ì‚¬ë‹¤ë¦¬ê²Œì„</title>
  <style>
    body{margin:0;padding:0;background:#000208;color:#fff;font-family:sans-serif;display:flex;justify-content:center;}
    .container{width:360px;}
    h1{margin:16px 0;text-align:center;}
    button{margin:8px auto;display:block;padding:8px 16px;font-size:16px;border:none;border-radius:4px;cursor:pointer;}
    #startBtn{background:#ffcd00;color:#000;}
    #canvas-wrap{overflow-x:auto;}
    canvas{background:#fff;display:block;margin:0 auto;border-radius:4px;}
    #results{margin-top:16px;list-style:none;padding:0;text-align:left;}
    #results li{margin:4px 0;}
    .punishment{color:#e74c3c;font-weight:bold;}
    .winner{color:#27ae60;font-weight:bold;}

    /* ì¹´í†¡ ê²°ê³¼ ì¹´ë“œ */
    .kakao-card{display:none;background:#1f2127;border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.5);margin-top:16px;}
    .kakao-header{display:flex;justify-content:space-between;padding:12px;}
    .kakao-header button{background:transparent;border:none;color:#fff;font-size:16px;cursor:pointer;}
    .kakao-body{text-align:center;padding:0 0 16px;}
    .result-text{margin:12px 0 8px;font-size:18px;}
    .result-text .name{color:#fff;}
    .result-text .icon{color:#ff695f;}
    .avatar{width:120px;height:120px;margin:0 auto;border-radius:50%;overflow:hidden;border:4px solid #2a2d33;}
    .avatar img{width:100%;height:100%;object-fit:cover;}
    .share-btn{width:100%;padding:12px;background:#1a73e8;color:#fff;font-size:16px;border:none;cursor:pointer;}
    .tags{display:flex;justify-content:space-around;padding:8px;background:#25272d;}
    .tags span{color:#aaa;font-size:12px;cursor:pointer;}
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ ì‚¬ë‹¤ë¦¬ê²Œì„</h1>
    <button id="startBtn">ì‚¬ë‹¤ë¦¬ íƒ€ê¸°</button>

    <!-- ì• ë‹ˆë©”ì´ì…˜ ì˜ì—­ -->
    <div id="canvas-wrap">
      <canvas id="ladder"></canvas>
    </div>
    <ul id="results"></ul>

    <!-- ì¹´í†¡ ê²°ê³¼ ì¹´ë“œ -->
    <div class="kakao-card" id="kakaoCard">
      <div class="kakao-header">
        <button id="btnBack">&lt; ì‚¬ë‹¤ë¦¬í™”ë©´</button>
        <button id="btnReload">âŸ³</button>
      </div>
      <div class="kakao-body">
        <div class="result-text">
          <span class="name" id="resultName">Name</span>ë‹˜ì´ 
          <span class="icon" id="resultIcon">ê½!</span> ì…ë‹ˆë‹¤~
        </div>
        <div class="avatar">
          <img id="resultImg" src="" alt="í”„ë¡œí•„"/>
        </div>
      </div>
      <button class="share-btn" id="btnShare">ê³µìœ í•˜ê¸°</button>
      <div class="tags">
        <span>#ì‚¬ë‹¤ë¦¬íƒ€ê¸°</span>
        <span>#ì¹´í†¡ì‚¬ë‹¤ë¦¬ê²Œì„</span>
        <span>#ë„¤ì´ë²„ì‚¬ë‹¤ë¦¬ê²Œì„</span>
      </div>
    </div>
  </div>

  <script>
    // ì°¸ê°€ì & ë²Œì¹™ì ì •ì˜
    const participants = [
      {name:"Jinsoo",        drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"Jinsoo.png",          color:"#3498db"},
      {name:"ì„¸ë¯¸",          drink:"ì›í•˜ëŠ” ìŒë£Œ ì„ íƒ!!!",        image:"semi.png",           color:"#9b59b6"},
      {name:"êµ¬ìê±´",        drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"gujagun.png",        color:"#e67e22"},
      {name:"ê¹€ë§Œì„±",        drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"kimmanseong.png",     color:"#1abc9c"},
      {name:"ê¹€ì„¸ë´‰",        drink:"ì›í•˜ëŠ” ìŒë£Œ ì„ íƒ!!!",        image:"kimsebung.png",      color:"#f1c40f"},
      {name:"ê¹€ì² ë™",        drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"kimcheoldong.png",    color:"#e84393"},
      {name:"ê¹€íƒœí˜¸",        drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"kimtaeho.png",       color:"#00cec9"},
      {name:"ì‹ ìœ ì„ ",        drink:"ì›í•˜ëŠ” ìŒë£Œ ì„ íƒ!!!",        image:"sinyuseon.png",      color:"#0984e3"},
      {name:"ê°€ë³´ìê³ ~~",   drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"gaboja.png",         color:"#d63031"},
      {name:"ì—„ê¸°ì¢…",        drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"eomgijong.png",      color:"#6c5ce7"},
      {name:"ì´ì¬ìŠ¹",        drink:"ì•„ìƒ·ì¶” 2ì” with someone...", image:"leejaeseung.png",    color:"#00b894"},
      {name:"ì „ë•ì„±(ë² ë“œë¡œ)",drink:"ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸",         image:"jeondeokseong.png",  color:"#fdcb6e"}
    ];
    const punishment = {name:"ì„ìƒí˜", drink:"ì¶•~ë‹¹ì²¨: ë”¸ê¸°ìš”ê±°íŠ¸ìƒ·ì¶”ê°€", image:"imsanghyuk.png", color:"#e74c3c"};

    const all = [punishment, ...participants];
    const cols = all.length, rows = 12;

    // ë ˆì´ì•„ì›ƒ
    const marginX=50, marginY=20, imgH=40, nameH=20;
    const colW=100, rowH=30;
    const cw=marginX*2 + colW*(cols-1);
    const ch=marginY*2 + imgH + nameH + rowH*rows;

    // ìº”ë²„ìŠ¤ ì„¸íŒ…
    const canvas=document.getElementById('ladder');
    canvas.width=cw; canvas.height=ch;
    const ctx=canvas.getContext('2d');

    // ê°€ë¡œì¤„ ëœë¤ ìƒì„±
    const rungs=Array.from({length:rows},()=>Array.from({length:cols-1},()=>Math.random()<0.4));

    // ì´ë¯¸ì§€ ë¡œë“œ
    const baseUrl='https://raw.githubusercontent.com/Devil-Destroyer/ladder/main/';
    const images=all.map(p=>{
      const img=new Image();
      img.src=baseUrl+encodeURIComponent(p.image);
      img.onload=drawLadder; img.onerror=drawLadder;
      return img;
    });

    // ì‚¬ë‹¤ë¦¬íŒ ê·¸ë¦¬ê¸°
    function drawLadder(){
      ctx.clearRect(0,0,cw,ch);
      ctx.font="14px sans-serif";
      all.forEach((p,i)=>{
        const x=marginX+i*colW;
        if(images[i].complete && images[i].naturalWidth>0){
          ctx.drawImage(images[i],x-20,marginY,40,imgH);
        } else {
          ctx.fillStyle="#ccc";
          ctx.fillRect(x-20,marginY,40,imgH);
        }
        ctx.fillStyle="#333"; ctx.textAlign="center";
        ctx.fillText(p.name,x,marginY+imgH+nameH-4);
      });
      ctx.strokeStyle="#ccc"; ctx.lineWidth=2;
      for(let i=0;i<cols;i++){
        const x=marginX+i*colW;
        ctx.beginPath(); ctx.moveTo(x,marginY+imgH+nameH);
        ctx.lineTo(x,marginY+imgH+nameH+rowH*rows);
        ctx.stroke();
      }
      for(let y=0;y<rows;y++){
        for(let x=0;x<cols-1;x++){
          if(rungs[y][x]){
            const x1=marginX+x*colW;
            const y1=marginY+imgH+nameH+y*rowH;
            ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x1+colW,y1);
            ctx.stroke();
          }
        }
      }
    }

    // ê²½ë¡œ ê³„ì‚°
    function computePaths(){
      return all.map((_,idx)=>{
        let cx=idx; const path=[{x:cx,y:0}];
        for(let y=0;y<rows;y++){
          if(rungs[y][cx]){
            cx++; path.push({x:cx,y:y});
          } else if(cx>0 && rungs[y][cx-1]){
            cx--; path.push({x:cx,y:y});
          }
          path.push({x:cx,y:y+1});
        }
        return path;
      });
    }

    // ì• ë‹ˆë©”ì´ì…˜
    function animate(){
      drawLadder();
      const paths=computePaths();
      let i=0;
      function drawOne(){
        const path=paths[i]; let step=0;
        ctx.lineWidth=4; ctx.strokeStyle=all[i].color;
        const timer=setInterval(()=>{
          if(step>0){
            const p0=path[step-1], p1=path[step];
            const x0=marginX+p0.x*colW, y0=marginY+imgH+nameH+p0.y*rowH;
            const x1=marginX+p1.x*colW, y1=marginY+imgH+nameH+p1.y*rowH;
            ctx.beginPath(); ctx.moveTo(x0,y0); ctx.lineTo(x1,y1); ctx.stroke();
          }
          step++;
          if(step>=path.length){
            clearInterval(timer);
            i++;
            if(i<paths.length) setTimeout(drawOne,200);
            else showResults();
          }
        },100);
      }
      drawOne();
    }

    // ê²°ê³¼ í‘œì‹œ & ì¹´ë“œ ì „í™˜
    function showResults(){
      document.getElementById('canvas-wrap').style.display='none';
      const card=document.getElementById('kakaoCard');
      card.style.display='block';
      document.getElementById('resultName').textContent = punishment.name;
      document.getElementById('resultIcon').textContent = 'ê½!';
      document.getElementById('resultImg').src         = baseUrl + encodeURIComponent(punishment.image);
    }

    // ì¹´ë“œ ë²„íŠ¼
    document.getElementById('btnBack').onclick=()=>location.reload();
    document.getElementById('btnReload').onclick=()=>location.reload();
    document.getElementById('btnShare').onclick=()=>alert('ê³µìœ í•˜ê¸° í´ë¦­ë¨');

    document.getElementById('startBtn').addEventListener('click',animate);
    drawLadder();
  </script>
</body>
</html>
